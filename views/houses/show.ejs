<%- include('../partials/header') %>
<house-nav>
  <a href="/houses/<%= house.prevHouse %>"><div class="nav-icon" id="nav-house-prev"></div></a>
  <span id="house-name"><%= house.name %></span>
  <a href="/houses/<%= house.nextHouse %>"><div class="nav-icon" id="nav-house-next"></div></a>
</house-nav>
<house-picture>
  <div class="nav-icon" id="nav-picture-prev"></div>
  <img src="<%= house.featuredPicture %>" width="800" height="600" id="house-picture-img">
  <div class="nav-icon" id="nav-picture-next"></div>
</house-picture>
<house-details>
  <table>
    <tr><td class="table-key">Location:</td><td><%= house.location %></td><td class="table-key">Latitude/Longitude:</td><td><%= house.latLon %></td></tr>
    <tr><td class="table-key">Construction Year:</td><td><%= house.constructionYear %></td><td class="table-key">Architectural Style:</td><td><%= house.archStyle %></td></tr>
  </table>
  <p><%= house.description %></p>
</house-details>
<script>
  const pictureList = [];
  <% let i = 0; %>
  <% for(const picture of house.pictures) { %>
    pictureList[<%= i %>] = '<%= picture.URI %>';
  <% i++; } %>
</script>
<house-comments>
  <% if(house.comments.length) { %>
    <table class="table"><tbody>
      <% for(comment of house.comments) { %>
        <tr>
          <td><b><%= comment.userName %>: </b></td>
          <td><%= comment.content %></td>
          <td>
            <% if(user && user._id.equals(comment.user)) { %>
              <form action="/comments/<%= comment._id %>?_m=DELETE" method="post"><button class="btn btn-danger btn-sm">Delete</button></form>
            <% } %>
          </td>
        </tr>
      <% } %>
    </table>
  <% } %>
  <% if(user) { %>
  <p>
    <form action="/houses/<%= house._id %>/comments" method="post">
      <label for="content">Add comment:</label><br>
      <input type="text" size="50" id="comment" name="content" placeholder="Enter a comment...">
      <button type="submit" class="btn btn-primary">Add Comment</button>
    </form>
  </p>
  <% } %>
</house-comments>
<% if(user) { %>
<house-admin>
  <form action="/houses/<%= house._id %>/pictures" method="post">
    <label for="URI">Add new picture:</label><br>
    <input type="text" size="50" id="URI" name="URI" placeholder="Enter URL...">
    <button type="submit" class="btn btn-primary">Add New Picture</button>
  </form>
  <br>
  <% if(user.equals(house.user)) { %>
  <a href="/houses/<%= house._id %>/edit" class="btn btn-primary">Edit/Delete This House</a>
  <% } %>
</house-admin>
<% } %>
<%- include('../partials/footer') %>
